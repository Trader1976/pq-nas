<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PQ-NAS • RAID Manager</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- Use PQ-NAS global themes -->
    <link rel="stylesheet" href="/static/theme.css">
    <script src="/static/theme.js"></script>

    <style>
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            color: var(--fg);
            font-family: var(--sans);
            background: var(--bg);
            overflow: hidden;
        }

        .wrap{
            height:100%;
            display:flex;
            flex-direction:column;
            padding:14px;
            gap:14px;
        }

        .panel{
            flex: 1 1 auto;
            min-height:0;
            border:1px solid rgba(255,255,255,0.12);
            border-radius: 18px;
            background: rgba(0,0,0,0.18);
            overflow:hidden;
            display:flex;
            flex-direction:column;
        }

        .bar{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:14px;
            padding:12px 14px;
            border-bottom:1px solid rgba(255,255,255,0.10);
            background: rgba(0,0,0,0.14);
        }

        .left{ display:flex; flex-direction:column; gap:4px; min-width:0; }
        .title{
            font-weight: 950;
            letter-spacing: 0.2px;
            font-size: 14px;
            white-space: nowrap;
            overflow:hidden;
            text-overflow: ellipsis;
        }
        .sub{
            font-size: 12px;
            opacity: 0.75;
            white-space: nowrap;
            overflow:hidden;
            text-overflow: ellipsis;
        }

        .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
        .btn{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            gap:8px;
            padding:10px 12px;
            border-radius: 14px;
            border:1px solid rgba(255,255,255,0.14);
            background: rgba(0,0,0,0.18);
            color: var(--fg);
            font-weight: 850;
            cursor:pointer;
            user-select:none;
        }
        .btn:hover{ border-color: rgba(255,255,255,0.22); background: rgba(255,255,255,0.06); }
        .btn.secondary{ opacity: 0.9; }
        .poolBar {
            display:flex;
            align-items:center;
            gap:10px;
            flex-wrap:wrap;
        }

        .poolSel {
            min-width: min(420px, 52vw);
            max-width: 62vw;
            padding:10px 12px;
            border-radius:14px;
            border:1px solid rgba(255,255,255,0.14);
            background: rgba(0,0,0,0.18);
            color: var(--fg);
            font-family: var(--sans);
            font-size: 12px;
        }
        .poolSel:focus { outline: none; border-color: rgba(255,255,255,0.26); }
        .poolLabel { opacity: .75; font-weight: 850; font-size: 12px; }
        .badge{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:6px 12px;
            border-radius:999px;
            font-size:12px;
            font-weight: 850;
            border:1px solid rgba(255,255,255,0.12);
            background: rgba(0,0,0,0.18);
            white-space:nowrap;
        }
        .badge.ok   { border-color: rgba(0,255,200,0.22); background: rgba(0,255,200,0.08); }
        .badge.warn { border-color: rgba(255,200,0,0.22); background: rgba(255,200,0,0.10); }
        .badge.err  { border-color: rgba(255,80,80,0.22); background: rgba(255,80,80,0.10); }

        .main{
            flex: 1 1 auto;
            min-height:0;
            overflow:auto;
            padding: 14px;
            display:flex;
            flex-direction:column;
            gap: 12px;
        }

        .card{
            border:1px solid rgba(255,255,255,0.12);
            border-radius: 16px;
            background: rgba(0,0,0,0.16);
            padding: 12px;
        }
        .card h3{
            margin: 0 0 8px 0;
            font-size: 13px;
            font-weight: 950;
            letter-spacing: 0.2px;
        }

        .row{
            display:flex;
            gap: 10px;
            align-items:center;
            flex-wrap: wrap;
        }

        .k{ opacity: 0.70; font-weight: 850; min-width: 130px; }
        .v{ font-family: var(--sans); opacity: 0.92; overflow-wrap: anywhere; }

        pre{
            margin: 0;
            padding: 10px 12px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.10);
            background: rgba(0,0,0,0.22);
            overflow:auto;
            max-height: 46vh;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: var(--mono);
            font-size: 12px;
            line-height: 1.35;
        }
        /* Keep these as mono explicitly */
        #rawOut, #progressOut, #actionOut, #confirmPre { font-family: var(--mono); }
        /* Status box should read like normal UI text (Shares Manager style) */
        #userStatus{
            font-family: var(--sans);
        }
        :root{
            /* Use global theme "info" hue so it stays visible in ALL themes */
            --raid-accent: rgba(var(--info-rgb, 0,140,255), 0.65);
            --raid-arrow: rgba(var(--info-rgb, 0,140,255), 0.85);
            --raid-arrow-soft: rgba(var(--info-rgb, 0,140,255), 0.45);

            /* Use theme surfaces instead of hardcoded black */
            --raid-bg: var(--panel);
            --raid-mid: rgba(var(--fg-rgb), 0.06);
            --raid-border: var(--border);
        }
        /* --- Exec progress bar (async jobs) --- */
        .pbarWrap{
            display:flex;
            flex-direction:column;
            gap:8px;
            margin-bottom:10px;
        }

        .pbarRow{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
            flex-wrap:wrap;
        }

        .pbarMeta{
            font-size:12px;
            opacity:0.85;
            font-family: var(--mono);
        }

        .pill{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:4px 10px;
            border-radius:999px;
            border:1px solid rgba(255,255,255,0.12);
            background: rgba(0,0,0,0.14);
            font-size:12px;
            font-weight:850;
            white-space:nowrap;
        }

        .pill.ok   { border-color: rgba(0,255,200,0.22); background: rgba(0,255,200,0.08); }
        .pill.warn { border-color: rgba(255,200,0,0.22); background: rgba(255,200,0,0.10); }
        .pill.err  { border-color: rgba(255,80,80,0.22); background: rgba(255,80,80,0.10); }

        .pbar{
            width:100%;
            height:12px;
            border-radius:999px;
            border:1px solid rgba(255,255,255,0.12);
            background: rgba(0,0,0,0.18);
            overflow:hidden;
        }

        .pbarFill{
            height:100%;
            width:0%;
            border-radius:999px;
            background: var(--accent, rgba(0,140,255,0.85));
            transition: width 160ms ease;
        }
        /* If your dark theme uses a class, tweak borders/bg to be brighter */
        body.theme-dark, body.dark {
            --raid-bg: rgba(0,0,0,0.12);
            --raid-mid: rgba(0,0,0,0.18);
            --raid-border: rgba(255,255,255,0.14);
        }
        /* Embedded mode */
        body.embedded .wrap{ padding:0; }
        body.embedded .panel{ border:0; border-radius:0; background: transparent; }
        body.embedded .bar{ border-bottom:1px solid rgba(255,255,255,0.10); border-radius:0; }
        /* Always red in every theme (beats theme.css win_classic/bright button overrides) */
        .btn.danger{
            background: var(--fail, var(--err, #dc322f)) !important;
            color: #fff !important;
            border: 1px solid rgba(var(--fail-rgb, 220,50,47), 0.85) !important;
            box-shadow: none !important;
        }

        .btn.danger:hover{
            filter: brightness(1.08);
        }
        html[data-theme="win_classic"] .btn.danger{
            border-color: rgba(0,0,0,0.35) !important;
            /* Toasts should match classic light surfaces */
            --toast-bg: rgba(246,246,246,0.96);
            --toast-border: rgba(0,0,0,0.22);
            --toast-fg: rgba(0,0,0,0.92);
            --toast-shadow: 0 10px 26px rgba(0,0,0,0.18);
        }
        /* Always red in every theme (beats theme.css per-theme button overrides) */
        /* Always red in every theme */
        .btn.danger{
            background: var(--fail, var(--err, #dc322f)) !important;
            color: #fff !important;
            border: 1px solid rgba(var(--fail-rgb, 220,50,47), 0.55) !important;
        }
        .btn.danger:hover{ filter: brightness(1.08); }
        .btn.danger:active{ filter: brightness(0.98); }
        .btn.danger:hover{ filter: brightness(1.08); }
        html[data-theme="win_classic"],
        body.theme-win_classic,
        body.win_classic{
            --toast-bg: rgba(246,246,246,0.96);
            --toast-border: rgba(0,0,0,0.22);
            --toast-fg: rgba(0,0,0,0.92);
            --toast-shadow: 0 10px 26px rgba(0,0,0,0.18);
        }
        .badge.info { border-color: rgba(0,140,255,0.22); background: rgba(0,140,255,0.10); }
    </style>
</head>

<body>
<div class="wrap">
    <div class="panel">
        <div class="bar">
            <div class="left">
                <div class="title" id="titleLine">RAID Manager</div>
                <div class="sub" id="subLine">Detecting RAID capabilities…</div>
            </div>

            <div class="actions">
                <div class="poolBar">
                    <span class="poolLabel">Pool:</span>
                    <select id="poolSelTop" class="poolSel" aria-label="Storage pool selector">
                        <option value="">(loading pools…)</option>
                    </select>
                </div>

                <span class="badge warn" id="badge">loading…</span>
                <button class="btn secondary" id="refreshBtn" type="button">Refresh</button>
                <div class="row" style="gap:10px; align-items:center;">
                    <button class="btn secondary" id="tabRaidBtn" type="button" aria-pressed="true">RAID</button>
                    <button class="btn secondary" id="tabPoolsBtn" type="button" aria-pressed="false">Pools</button>
                </div>
            </div>
        </div>

        <div class="main">

            <!-- TAB: RAID -->
            <div id="raidTab">
                <!-- User-friendly status (always visible) -->
                <div class="card" id="statusCard">
                    <h3>Status</h3>
                    <pre id="userStatus">(loading)</pre>
                </div>

                <!-- Actions (always visible) -->
                <div class="card" id="actionsCard">
                    <h3>Manage storage pool</h3>
                    <div id="actionsOut"></div>
                </div>

                <!-- Developer-only: probe -->
                <div class="card" id="probeCard">
                    <h3>Probe</h3>
                    <div id="probeOut"></div>
                </div>

                <!-- Developer-only: topology -->
                <div class="card" id="topologyCard">
                    <h3>Topology</h3>
                    <div id="topology"></div>
                </div>

                <!-- Developer-only: raw -->
                <div class="card" id="rawCard">
                    <h3>Discovery / Status (raw)</h3>
                    <pre id="rawOut">(loading)</pre>
                </div>

                <!-- Developer mode toggle (bottom) -->
                <div class="card" id="devModeCard">
                    <label style="display:flex; gap:10px; align-items:center;">
                        <input id="devModeChk" type="checkbox" style="transform:scale(1.1);">
                        <span class="v" style="opacity:.9;">Developer mode</span>
                    </label>
                    <div class="v" style="opacity:.7; margin-top:6px;">
                        Shows raw outputs and advanced controls.
                    </div>
                </div>
            </div>

            <!-- TAB: POOLS -->
            <div id="poolsTab" style="display:none;">
                <div class="card">
                    <h3>Pools</h3>

                    <div id="poolsOut" class="v" style="margin-top:10px; white-space:pre-wrap;"></div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="./app.js"></script>
</body>
</html>
