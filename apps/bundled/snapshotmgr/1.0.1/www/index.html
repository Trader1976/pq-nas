<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PQ-NAS • Snapshot Manager</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="/static/theme.js"></script>
    <link rel="stylesheet" href="/static/theme.css">
    <style>
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body { margin: 0; color: var(--fg); font-family: var(--sans); background: var(--bg); }
        body.embedded { background: transparent; }

        .app {
            height: 100%;
            display: grid;
            grid-template-rows: auto auto 1fr auto;
            gap: 12px;
            padding: 12px;
        }

        .topbar {
            display:flex; align-items:center; justify-content:space-between;
            padding: 10px 12px;
            border: 1px solid rgba(var(--fg-rgb),0.14);
            border-radius: 14px;
            background: rgba(var(--panel-rgb),0.55);
            backdrop-filter: blur(10px);
        }
        .title { font-weight: 900; letter-spacing: 0.2px; }
        .badge { font-weight: 900; padding: 6px 10px; border-radius: 999px; border:1px solid rgba(var(--fg-rgb),0.18); }
        .badge.ok { background: rgba(0,0,0,0.12); }
        .badge.warn { background: rgba(255,190,0,0.12); }
        .badge.err { background: rgba(255,60,60,0.12); }

        .btn {
            border:1px solid rgba(var(--fg-rgb),0.18);
            background: rgba(var(--panel-rgb),0.35);
            color: var(--fg);
            padding: 10px 12px;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
        }
        .btn.danger { border-color: rgba(255,60,60,0.45); }
        .btn:disabled { opacity: 0.55; cursor: not-allowed; }

        .main {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 12px;
            min-height: 0;
        }

        .card {
            border: 1px solid rgba(var(--fg-rgb),0.14);
            border-radius: 16px;
            background: rgba(var(--panel-rgb),0.35);
            min-height: 0;
            overflow: hidden;
            display: grid;
            grid-template-rows: auto 1fr;
        }

        .cardHead {
            display:flex; align-items:center; justify-content:space-between;
            padding: 10px 12px;
            border-bottom: 1px solid rgba(var(--fg-rgb),0.12);
            background: rgba(var(--panel-rgb),0.45);
            font-weight: 900;
        }

        .list { overflow:auto; padding: 8px; display:flex; flex-direction:column; gap:8px; }
        .row {
            border: 1px solid rgba(var(--fg-rgb),0.12);
            background: rgba(var(--panel-rgb),0.25);
            border-radius: 14px;
            padding: 10px 10px;
            cursor: pointer;
        }
        .row.sel { outline: 2px solid rgba(var(--fg-rgb),0.28); }
        .row .top { display:flex; justify-content:space-between; gap:10px; font-weight: 900; }
        .row .sub { opacity: 0.85; font-size: 13px; margin-top: 4px; }

        .footer {
            display:flex; gap:10px; align-items:center; justify-content:space-between;
            padding: 10px 12px;
            border: 1px solid rgba(var(--fg-rgb),0.14);
            border-radius: 14px;
            background: rgba(var(--panel-rgb),0.35);
        }
        .row.warn { filter: grayscale(0.2); }

        .row.notSubvol {
            background: rgba(255, 200, 0, 0.12);
            border: 1px solid rgba(255, 180, 0, 0.4);
        }
        #appVersion {
            margin-left: 10px;
            font-size: 0.85em;
            opacity: 0.65;
            font-weight: 700;
        }



        .banner{
            display:flex;
            align-items:center;
            gap:10px;

            border: 1px solid rgba(var(--warn-rgb),0.45);
            background: rgba(var(--warn-rgb),0.10);

            border-radius: 12px;
            padding: 8px 12px;

            font-weight: 700;
            font-size: 14px;
            line-height: 1.25;

            /* prevent huge vertical expansion */
            max-height: 42px;
            overflow: hidden;
            margin-top: 4px;
            margin-bottom: 0;
        }

        .banner a{
            font-weight: 900;
            text-decoration: underline;
            white-space: nowrap;
        }


        .row.noPrivs {
            background: rgba(255, 190, 0, 0.10);
            border: 1px solid rgba(255, 190, 0, 0.35);
        }

        .pillWarn {
            display:inline-flex;
            align-items:center;
            justify-content:center;
            min-width: 22px;
            height: 22px;
            padding: 0 6px;
            border-radius: 999px;
            border: 1px solid rgba(255, 190, 0, 0.45);
            background: rgba(255, 190, 0, 0.14);
            font-weight: 900;
        }



        .modalTitle{
            font-weight: 1000;
            display:flex;
            align-items:center;
            gap: 8px;
        }

        .modalBody{
            padding: 12px;
            overflow: auto;
        }

        .modalGrid{
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 12px;
            height: 100%;
        }

        @media (max-width: 860px){
            .modalGrid{ grid-template-columns: 1fr; }
        }


        .modalPanel h3{
            margin: 0 0 8px;
            font-size: 14px;
            font-weight: 1000;
        }

        .modalNote{
            opacity: 0.9;
            line-height: 1.35;
            margin-bottom: 10px;
        }

        .modalOverlay{
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.62);   /* darker overlay */
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
            z-index: 9999;
        }

        .modalCard{
            width: min(980px, 96vw);
            height: min(84vh, 820px);
            border-radius: 16px;
            border: 1px solid rgba(var(--fg-rgb),0.22);


            /* default for DARK themes */
            background: rgba(0,0,0,0.82);

            display: grid;
            grid-template-rows: auto 1fr;
            overflow: hidden;
            box-shadow: 0 22px 80px rgba(0,0,0,0.55);
            outline: 1px solid rgba(255,255,255,0.05);
        }

        .modalHead{
            display:flex;
            justify-content:space-between;
            gap:10px;
            align-items:center;
            padding: 12px 12px;
            border-bottom: 1px solid rgba(var(--fg-rgb),0.12);

            /* match card */
            background: rgba(0,0,0,0.82);
        }



        .modalPanel{
            border: 1px solid rgba(var(--fg-rgb),0.14);

            /* make the panels solid too */
            background: rgba(0,0,0,0.28);
            border-radius: 14px;
            padding: 12px;
            overflow: auto;
            min-height: 0;
        }


        .modalPanel pre{
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid rgba(var(--fg-rgb),0.14);
            background: rgba(0,0,0,0.50);
            border-radius: 12px;
            padding: 10px;
            margin: 0;
            overflow: auto;
            font-size: 12px;
            line-height: 1.3;
        }

        html[data-theme="bright"] .modalPanel pre,
        html[data-theme="win_classic"] .modalPanel pre{
            background: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.14);
        }




        .modalActions{
            display:flex;
            gap:10px;
            align-items:center;
        }

        .warnIcon{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            width: 22px;
            height: 22px;
            border-radius: 999px;
            border: 1px solid rgba(255,190,0,0.45);
            background: rgba(255,190,0,0.14);
            font-weight: 1000;
        }

        /* BRIGHT theme: light modal surface */
        html[data-theme="bright"] .modalCard,
        html[data-theme="bright"] .modalHead{
            background: rgba(255,255,255,0.96);
            outline: 1px solid rgba(0,0,0,0.08);
        }
        #warnBanner{
            position: relative;
            z-index: 5;
            /* optional: make it feel “inside” the same card spacing */
            margin-top: -6px;   /* tweak if you want it closer to topbar */
        }
        /* WIN_CLASSIC: use classic panel colors */
        html[data-theme="win_classic"] .modalCard,
        html[data-theme="win_classic"] .modalHead{
            background: linear-gradient(180deg, var(--panel2), var(--panel));
            outline: 1px solid var(--border2);
            outline-offset: -2px;
        }

        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
        .hint { opacity: 0.9; }
    </style>
</head>
<body>
<div class="app">
    <div class="topbar">
        <div class="title" id="titleLine">
            Snapshot Manager <span id="appVersion" class="ver"></span>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
            <span class="badge ok" id="badge">ready</span>
            <button class="btn" id="refreshBtn">Refresh</button>
            <button class="btn" id="snapNowBtn">Snapshot now</button>

        </div>
    </div>

    <div id="warnBanner" class="banner" style="display:none"></div>

    <div class="main">
        <div class="card">
            <div class="cardHead">
                <span>Volumes</span>
                <span class="hint mono" id="volHint"></span>
            </div>
            <div class="list" id="volList"></div>
        </div>

        <div class="card">
            <div class="cardHead">
                <span>Snapshots</span>
                <span class="hint mono" id="snapHint"></span>
            </div>
            <div class="list" id="snapList"></div>
        </div>
    </div>

    <div class="footer">
        <div id="status" class="hint">Ready.</div>
        <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn" id="detailsBtn" disabled>Details</button>
            <button class="btn danger" id="restoreBtn" disabled>Restore…</button>
        </div>
    </div>
</div>

<!-- Modal lives OUTSIDE .app so it overlays everything cleanly -->
<div id="modalOverlay" class="modalOverlay" aria-hidden="true" style="display:none;">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modalHead">
            <div class="modalTitle" id="modalTitle">Details</div>
            <button class="btn" id="modalCloseBtn">Close</button>
        </div>
        <div id="modalBody" class="modalBody"></div>
    </div>
</div>

<script src="./app.js"></script>
</body>
</html>
